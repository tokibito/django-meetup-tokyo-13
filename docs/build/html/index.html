

<!doctype html>

<html lang="ja" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>DjangoMeetupTokyo #13 中級者向けハンズオン &#8212; django-meetup-tokyo-13  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="_static/bizstyle.css?v=532c1bf3" />
    
    <script src="_static/documentation_options.js?v=c033477b"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/translations.js?v=4dbe4bdc"></script>
    <script src="_static/bizstyle.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="nav-item nav-item-0"><a href="#">django-meetup-tokyo-13  ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">DjangoMeetupTokyo #13 中級者向けハンズオン</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="djangomeetuptokyo-13">
<h1>DjangoMeetupTokyo #13 中級者向けハンズオン<a class="headerlink" href="#djangomeetuptokyo-13" title="Link to this heading">¶</a></h1>
<section id="id1">
<h2>イベント概要<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://django.connpass.com/event/312782/">https://django.connpass.com/event/312782/</a></p>
</section>
<section id="id2">
<h2>中級者向けハンズオンについて<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>チュートリアルは理解できている、Djangoは使ったことあるけど、使いこなせてない～という人向けのハンズオンです。 用意した資料を見ながら課題を実装していきます。</p>
<p>会議室予約システムの実装を通じて、Djangoの認証機能、ユーザー機能などの使い方を学びます。</p>
</section>
<section id="id3">
<h2>作業環境の準備<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>Python 3.12（Python3.10以上）</dt><dd><ul>
<li><p>venvモジュールが使える状態にしてください。Ubuntuなどの環境では <code class="docutils literal notranslate"><span class="pre">python3.12-venv</span></code> のようなパッケージを入れる必要があるかもしれません。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">python3.12</span> <span class="pre">-m</span> <span class="pre">venv</span> <span class="pre">venv</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Django 5.0系（最新 5.0.4）</dt><dd><ul>
<li><p>venv環境にインストールしておいてください。</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>VisualStudioCodeまたは、使い慣れたエディター</dt><dd><ul>
<li><p>Python, Djangoで開発できる状態にしておいてください。</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="id4">
<h2>このハンズオンの完成形のコード<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<p>GitHub上に完成形のコードがあります。コードを書き進めていて、うまく動かない場合に参考にしてみてください。</p>
<p><a class="reference external" href="https://github.com/tokibito/django-meetup-tokyo-13/">https://github.com/tokibito/django-meetup-tokyo-13/</a></p>
</section>
<section id="id5">
<h2>資料<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://tokibito.github.io/django-meetup-tokyo-13/">https://tokibito.github.io/django-meetup-tokyo-13/</a></p>
</section>
<section id="id6">
<h2>作成するアプリケーションについて<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h2>
<p>会議室の予約システムを想定したアプリケーションを作成します。</p>
<section id="id7">
<h3>ユーザーの種別<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<p>このシステムを利用するユーザーの種別は以下の３種類を想定します。</p>
<ul class="simple">
<li><dl class="simple">
<dt>一般ユーザー <cite>UserType:1:normal</cite></dt><dd><ul>
<li><p>一般ユーザーが利用可能な会議室を予約できます。</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>上級ユーザー <cite>UserType:2:advanced</cite></dt><dd><ul>
<li><p>一般ユーザーが利用可能な会議室に加えて、上級ユーザーが利用可能な会議室を予約できます。</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="id8">
<h3>会議室一覧<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h3>
<p>利用可能な会議室の一覧を表示します。ログインしていない場合でも閲覧できるページです。</p>
<p>ログインしている場合は、会議室の予約フォームへのリンクが表示されます。</p>
</section>
<section id="id9">
<h3>ログイン<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h3>
<p>ユーザーアカウントを使ってログインします。</p>
</section>
<section id="id10">
<h3>ログアウト<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h3>
<p>ログイン中のユーザーをログアウトします。</p>
</section>
<section id="id11">
<h3>予約フォーム<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h3>
<p>ログイン中のユーザーで、会議室を予約します。</p>
<p>予約は、日付と日時を登録します。他の予約とのぶつかりはチェックしません。</p>
</section>
<section id="id12">
<h3>自分の予約一覧<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h3>
<p>ログイン中のユーザーの予約の一覧を表示します。</p>
</section>
<section id="id13">
<h3>ユーザー登録<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h3>
<p>ユーザー登録をする画面です。</p>
</section>
</section>
<section id="id14">
<h2>プロジェクトの作成とセットアップ<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h2>
<section id="django">
<h3>Djangoのプロジェクト作成<a class="headerlink" href="#django" title="Link to this heading">¶</a></h3>
<p>今回は <code class="docutils literal notranslate"><span class="pre">myproject</span></code> という名前のプロジェクトで作成します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(venv)$ django-admin startproject myproject
(venv)$ cd myproject
</pre></div>
</div>
<p><strong>以降の説明は、このmyprojectディレクトリ以下を起点とします。</strong></p>
</section>
<section id="id15">
<h3>言語とタイムゾーンの設定<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h3>
<p>myproject/settings.py:</p>
<p>言語は日本語、タイムゾーンはAsia/Tokyoに設定します。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s2">&quot;ja&quot;</span>
<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s2">&quot;Asia/Tokyo&quot;</span>
</pre></div>
</div>
</section>
<section id="django-debug-toolbar">
<h3>django-debug-toolbarのセットアップ<a class="headerlink" href="#django-debug-toolbar" title="Link to this heading">¶</a></h3>
<p>django-debug-toolbarをインストール、セットアップしておきます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(venv)$ pip install django-debug-toolbar
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<ul class="simple">
<li><p><a class="reference external" href="https://django-debug-toolbar.readthedocs.io/en/latest/">django-debug-toolbar</a></p></li>
<li><p><a class="reference external" href="https://docs.djangoproject.com/ja/5.0/intro/tutorial08/">はじめてのDjangoアプリ作成、その8 | Django ドキュメント</a></p></li>
</ul>
</div>
<p>myproject/settings.py:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s2">&quot;debug_toolbar&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INTERNAL_IPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;debug_toolbar.middleware.DebugToolbarMiddleware&quot;</span><span class="p">,</span>
    <span class="c1"># ...</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><code class="docutils literal notranslate"><span class="pre">DebugToolbarMiddleware</span></code> は、なるべく外側に配置したほうがよいとドキュメントに書かれています。
GZipMiddlewareのように、レスポンスボディを加工するミドルウェアを使っている場合は、それよりも後に配置する必要があります。
DebugToolbarMiddlewareは、レスポンスのHTMLにscriptタグを差し込む処理を行っているためです。</p>
</div>
<p>myproject/urls.py:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>  <span class="c1"># includeを追加しています</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;__debug__/&quot;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s2">&quot;debug_toolbar.urls&quot;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>これでdjango-debug-toolbarのセットアップまで完了です。</p>
</section>
<section id="id17">
<h3>初回データベースマイグレーション<a class="headerlink" href="#id17" title="Link to this heading">¶</a></h3>
<p>初回のデータベースマイグレーションを行います。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(venv)$ python manage.py migrate
</pre></div>
</div>
</section>
<section id="id18">
<h3>管理者ユーザーの作成<a class="headerlink" href="#id18" title="Link to this heading">¶</a></h3>
<p>Django管理サイト用のユーザーを作成しておきます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(venv)$ python manage.py createsuperuser
</pre></div>
</div>
</section>
<section id="id19">
<h3>セットアップ状態の動作確認<a class="headerlink" href="#id19" title="Link to this heading">¶</a></h3>
<p>runserverで動作確認してください。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(venv)$ python manage.py runserver
</pre></div>
</div>
<p><a class="reference external" href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a> をブラウザで開いて確認します。Djangoの管理画面が表示されればOKです。</p>
</section>
</section>
<section id="account">
<h2>accountアプリケーションを作成<a class="headerlink" href="#account" title="Link to this heading">¶</a></h2>
<p>ユーザーの種別と、ユーザープロフィールを先に定義するため、accountアプリケーションを作成します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(venv)$ python manage.py startapp account
</pre></div>
</div>
<p>myproject/settings.py:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s2">&quot;account&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id20">
<h2>ユーザー種別の定義とユーザープロフィールのモデルを作成<a class="headerlink" href="#id20" title="Link to this heading">¶</a></h2>
<p>account/models.py:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>


<span class="k">class</span> <span class="nc">UserType</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">IntegerChoices</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ユーザー種別&quot;&quot;&quot;</span>

    <span class="n">NORMAL</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;一般&quot;</span>
    <span class="n">ADVANCED</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;上級&quot;</span>


<span class="k">class</span> <span class="nc">UserProfile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ユーザープロフィール&quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;ユーザー&quot;</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;user_profile&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">user_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span>
        <span class="s2">&quot;ユーザー種別&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">UserType</span><span class="o">.</span><span class="n">choices</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;ユーザープロフィール&quot;</span>
</pre></div>
</div>
<p>account/admin.py:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">models</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">UserProfile</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>ユーザープロフィールは、ユーザーと1対1の関係であるため、OneToOneFieldを使っています。</p>
<p>参考: <a class="reference external" href="https://docs.djangoproject.com/ja/5.0/topics/db/examples/one_to_one/">1対1のリレーションシップ</a></p>
<p>AUTH_USER_MODELは、settings.pyで指定されたユーザーモデルです。</p>
<p>デフォルト値: <code class="docutils literal notranslate"><span class="pre">&quot;auth.User&quot;</span></code></p>
</div>
<section id="id22">
<h3>マイグレーション<a class="headerlink" href="#id22" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(venv)$ python manage.py makemigrations account
(venv)$ python manage.py migrate
</pre></div>
</div>
</section>
</section>
<section id="reservation">
<h2>reservationアプリケーションを作成<a class="headerlink" href="#reservation" title="Link to this heading">¶</a></h2>
<p>予約機能のためのreservationアプリケーションを作成します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(venv)$ python manage.py startapp reservation
</pre></div>
</div>
<p>myproject/settings.py:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s2">&quot;reservation&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id23">
<h2>会議室と予約のモデルを作成<a class="headerlink" href="#id23" title="Link to this heading">¶</a></h2>
<p>reservation/models.py:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">account.models</span> <span class="kn">import</span> <span class="n">UserType</span>


<span class="k">class</span> <span class="nc">Room</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;会議室&quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s2">&quot;会議室名&quot;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">available_user_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span>
        <span class="s2">&quot;利用可能ユーザー種別&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">UserType</span><span class="o">.</span><span class="n">choices</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;会議室&quot;</span>


<span class="k">class</span> <span class="nc">Reservation</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;予約&quot;&quot;&quot;</span>
    <span class="n">room</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Room</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">room</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;予約&quot;</span>
</pre></div>
</div>
<p>ユーザーに紐づくデータは、ForeignKeyでUserモデルを参照しています。</p>
<p>reservation/admin.py:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">models</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Room</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Reservation</span><span class="p">)</span>
</pre></div>
</div>
<section id="id24">
<h3>マイグレーション<a class="headerlink" href="#id24" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(venv)$ python manage.py makemigrations reservation
(venv)$ python manage.py migrate
</pre></div>
</div>
</section>
</section>
<section id="id25">
<h2>会議室一覧ページを作成<a class="headerlink" href="#id25" title="Link to this heading">¶</a></h2>
<p>reservation/views.py:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">generic</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">RoomListView</span><span class="p">(</span><span class="n">generic</span><span class="o">.</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Room</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;reservation/index.html&quot;</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">available_rooms</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Room</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">available_rooms</span>
</pre></div>
</div>
<p>RoomListViewをurls.pyに登録します。</p>
<p>reservation/urls.py:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">RoomListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>reservation/urls.pyをmyproject/urls.pyに登録します。</p>
<p>myproject/urls.py:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;reservation/&quot;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s2">&quot;reservation.urls&quot;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>reservation/templates/base.html:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>reservation/templates/reservation/index.html:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{{</span> <span class="nv">room.name</span> <span class="cp">}}</span> の予約<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">room.name</span> <span class="cp">}}</span> の予約<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
  <span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>
  <span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>送信<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>TODO: ...</p>
</section>
<section id="id26">
<h2>追加課題<a class="headerlink" href="#id26" title="Link to this heading">¶</a></h2>
<p>時間に余裕のある人向けの追加課題です。</p>
<ul class="simple">
<li><dl class="simple">
<dt>ログイン中のユーザーのパスワードを変更する画面を作る</dt><dd><ul>
<li><p>パスワード変更を行う画面（フォーム）を作ってみましょう。</p></li>
<li><p>パスワードを変更するAPIがあります。</p></li>
<li><p><a class="reference external" href="https://docs.djangoproject.com/ja/5.0/topics/auth/default/#changing-passwords">https://docs.djangoproject.com/ja/5.0/topics/auth/default/#changing-passwords</a></p></li>
<li><p>もしくは、 <cite>django.contrib.auth.forms.PasswordChangeForm</cite> や <cite>django.contrib.auth.views.PasswordChangeView</cite> を利用することもできます。</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>ユーザー登録にメールアドレスの確認を必須とする</dt><dd><ul>
<li><p>メールアドレスを登録していない場合、パスワードリセット等で困る場合があります。</p></li>
<li><dl class="simple">
<dt>django-registrationを使って実装することもできます。</dt><dd><ul>
<li><p><a class="reference external" href="https://pypi.org/project/django-registration/">https://pypi.org/project/django-registration/</a></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>パスワードリセット画面を実装する</dt><dd><ul>
<li><p>「パスワードを忘れてしまった場合」に対応する画面を作ってみましょう。</p></li>
<li><p>メールを送信して、メールに書かれたURLからパスワードを設定する画面を造ります。</p></li>
<li><p>または、 <cite>django.contrib.auth.views.PasswordResetView</cite> を利用することもできます。</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>指定のユーザーに成り代わってログインする</dt><dd><ul>
<li><p>Djangoの管理画面から特定のユーザーに成り代わってログインをする機能が欲しい場合、django-hijackを利用できます。試してみましょう。</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>外部の認証プロバイダーによるログインを実現する</dt><dd><ul>
<li><p>django-allauthを使うと、XやGoogle、Facebookなどのアカウントを使ったログインを実現できます。</p></li>
<li><p>SNS等の場合は、OAuthというプロトコルで外部の認証プロバイダーを利用できます。認証プロトコルはOAuth以外にSAMLなどがあります。</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="#">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">DjangoMeetupTokyo #13 中級者向けハンズオン</a><ul>
<li><a class="reference internal" href="#id1">イベント概要</a></li>
<li><a class="reference internal" href="#id2">中級者向けハンズオンについて</a></li>
<li><a class="reference internal" href="#id3">作業環境の準備</a></li>
<li><a class="reference internal" href="#id4">このハンズオンの完成形のコード</a></li>
<li><a class="reference internal" href="#id5">資料</a></li>
<li><a class="reference internal" href="#id6">作成するアプリケーションについて</a><ul>
<li><a class="reference internal" href="#id7">ユーザーの種別</a></li>
<li><a class="reference internal" href="#id8">会議室一覧</a></li>
<li><a class="reference internal" href="#id9">ログイン</a></li>
<li><a class="reference internal" href="#id10">ログアウト</a></li>
<li><a class="reference internal" href="#id11">予約フォーム</a></li>
<li><a class="reference internal" href="#id12">自分の予約一覧</a></li>
<li><a class="reference internal" href="#id13">ユーザー登録</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id14">プロジェクトの作成とセットアップ</a><ul>
<li><a class="reference internal" href="#django">Djangoのプロジェクト作成</a></li>
<li><a class="reference internal" href="#id15">言語とタイムゾーンの設定</a></li>
<li><a class="reference internal" href="#django-debug-toolbar">django-debug-toolbarのセットアップ</a></li>
<li><a class="reference internal" href="#id17">初回データベースマイグレーション</a></li>
<li><a class="reference internal" href="#id18">管理者ユーザーの作成</a></li>
<li><a class="reference internal" href="#id19">セットアップ状態の動作確認</a></li>
</ul>
</li>
<li><a class="reference internal" href="#account">accountアプリケーションを作成</a></li>
<li><a class="reference internal" href="#id20">ユーザー種別の定義とユーザープロフィールのモデルを作成</a><ul>
<li><a class="reference internal" href="#id22">マイグレーション</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reservation">reservationアプリケーションを作成</a></li>
<li><a class="reference internal" href="#id23">会議室と予約のモデルを作成</a><ul>
<li><a class="reference internal" href="#id24">マイグレーション</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id25">会議室一覧ページを作成</a></li>
<li><a class="reference internal" href="#id26">追加課題</a></li>
</ul>
</li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.rst.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             >索引</a></li>
        <li class="nav-item nav-item-0"><a href="#">django-meetup-tokyo-13  ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">DjangoMeetupTokyo #13 中級者向けハンズオン</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; 著作権 2024, Shinya Okano.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>